<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[Kubernetes The Hard Way] Provisioning a CA and Generating TLS Certificates - Part 2 - My Personal Ngoprek Problems &gt;_</title>
<meta name="description" content="ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ Provisioning a CA and Generating TLS Certificates (Kubernetes The Hardway)">


  <meta name="author" content=">_">
  
  <meta property="article:author" content=">_">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="My Personal Ngoprek Problems >_">
<meta property="og:title" content="[Kubernetes The Hard Way] Provisioning a CA and Generating TLS Certificates - Part 2">
<meta property="og:url" content="http://localhost:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-part2/">


  <meta property="og:description" content="ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ Provisioning a CA and Generating TLS Certificates (Kubernetes The Hardway)">







  <meta property="article:published_time" content="2020-04-13T00:00:00+07:00">






<link rel="canonical" href="http://localhost:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-part2/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>


  <meta name="google-site-verification" content="zKB-7_EmphHj7Wpc-lRmu7BjIVPWRvMJkoqWQQBSjEI" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="My Personal Ngoprek Problems >_ Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          My Personal Ngoprek Problems >_
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">üéØ Home</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/">üìù Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/404.html">üèÜ Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">üìö Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">üë® About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt=">_" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">>_</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>‚ÄúMy name is Ammar and this is my personal blog, documenting my journey on the quest to become the best person I can be.‚Äù<br /></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://www.ammarun.my.id" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/ammarun11" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://instagram.com/nopallll" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[Kubernetes The Hard Way] Provisioning a CA and Generating TLS Certificates - Part 2">
    <meta itemprop="description" content="ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖProvisioning a CA and Generating TLS Certificates (Kubernetes The Hardway)">
    <meta itemprop="datePublished" content="2020-04-13T00:00:00+07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[Kubernetes The Hard Way] Provisioning a CA and Generating TLS Certificates - Part 2
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="ÿ®Ÿêÿ≥ŸíŸÖŸê-ÿßŸÑŸÑŸéŸëŸáŸê-ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê-ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ</h1>
<h2 id="provisioning-a-ca-and-generating-tls-certificates-kubernetes-the-hardway">Provisioning a CA and Generating TLS Certificates (Kubernetes The Hardway)</h2>

<p>Lanjutkeunn, Lab part 2 Di lab ini Anda akan menyediakan Infrastruktur PKI menggunakan PKI toolkit, <a href="https://github.com/cloudflare/cfssl">cfssl</a>, kemudian menggunakannya untuk mem-bootstrap Otoritas Sertifikat, dan menghasilkan sertifikat TLS untuk komponen berikut: etcd, kube-apiserver, kube-controller-manager, kube-scheduler, kubelet, dan kube-proxy.</p>

<h2 id="certificate-authority">Certificate Authority</h2>
<hr />
<p>In this section you will provision a Certificate Authority that can be used to generate additional TLS certificates.</p>

<p>Generate the CA configuration file, certificate, and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"signing"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"default"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"expiry"</span><span class="o">:</span><span class="w"> </span><span class="s2">"8760h"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"profiles"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"kubernetes"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"usages"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"signing"</span><span class="p">,</span><span class="w"> </span><span class="s2">"key encipherment"</span><span class="p">,</span><span class="w"> </span><span class="s2">"server auth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"client auth"</span><span class="p">],</span><span class="w">
        </span><span class="s2">"expiry"</span><span class="o">:</span><span class="w"> </span><span class="s2">"8760h"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ca</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="o">-</span><span class="n">initca</span><span class="w"> </span><span class="n">ca</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">ca</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">ca.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="client-and-server-certificates">Client and Server Certificates</h2>
<hr />
<p>In this section you will generate client and server certificates for each Kubernetes component and a client certificate for the Kubernetes admin user.</p>

<p>The Admin Client Certificate
Generate the admin client certificate and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">admin</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:masters"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">admin</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">admin</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">admin</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">admin.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-kubelet-client-certificates">The Kubelet Client Certificates</h2>
<hr />
<p>Kubernetes uses a special-purpose authorization mode called Node Authorizer, that specifically authorizes API requests made by Kubelets. In order to be authorized by the Node Authorizer, Kubelets must use a credential that identifies them as being in the system:nodes group, with a username of system:node:<nodeName>. In this section you will create a certificate for each Kubernetes worker node that meets the Node Authorizer requirements.</nodeName></p>

<p>Generate a certificate and private key for each Kubernetes worker node:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="w"> </span><span class="n">worker</span><span class="m">-2</span><span class="p">;</span><span class="w"> </span><span class="n">do</span><span class="w">
</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:node:${instance}"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:nodes"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">EXTERNAL_IP</span><span class="o">=$</span><span class="p">(</span><span class="n">lxc</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">eth0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="m">-1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="s1">'{print $3}'</span><span class="p">)</span><span class="w">


</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">hostname</span><span class="o">=$</span><span class="p">{</span><span class="n">instance</span><span class="p">},</span><span class="o">$</span><span class="p">{</span><span class="n">EXTERNAL_IP</span><span class="p">}</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="w">
</span><span class="n">done</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">worker</span><span class="m">-0</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">worker</span><span class="m">-0</span><span class="n">.pem</span><span class="w">
</span><span class="n">worker</span><span class="m">-1</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">worker</span><span class="m">-1</span><span class="n">.pem</span><span class="w">
</span><span class="n">worker</span><span class="m">-2</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">worker</span><span class="m">-2</span><span class="n">.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-controller-manager-client-certificate">The Controller Manager Client Certificate</h2>
<p>Generate the kube-controller-manager client certificate and private key:</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:kube-controller-manager"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:kube-controller-manager"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-kube-proxy-client-certificate">The Kube Proxy Client Certificate</h2>
<p>Generate the kube-proxy client certificate and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:kube-proxy"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:node-proxier"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">kube</span><span class="o">-</span><span class="n">proxy.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-scheduler-client-certificate">The Scheduler Client Certificate</h2>
<p>Generate the kube-scheduler client certificate and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:kube-scheduler"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"system:kube-scheduler"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">kube</span><span class="o">-</span><span class="n">scheduler.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-kubernetes-api-server-certificate">The Kubernetes API Server Certificate</h2>
<p>The kubernetes-the-hard-way static IP address will be included in the list of subject alternative names for the Kubernetes API Server certificate. This will ensure the certificate can be validated by remote clients.</p>

<p>Generate the Kubernetes API Server certificate and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">KUBERNETES_PUBLIC_ADDRESS</span><span class="o">=</span><span class="m">10.240.0.62</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">kubernetes</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"kubernetes"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">hostname</span><span class="o">=</span><span class="m">10.32.0.1</span><span class="p">,</span><span class="m">10.240.0.88</span><span class="p">,</span><span class="m">10.240.0.161</span><span class="p">,</span><span class="m">10.240.0.39</span><span class="p">,</span><span class="o">$</span><span class="p">{</span><span class="n">KUBERNETES_PUBLIC_ADDRESS</span><span class="p">},</span><span class="m">127.0.0.1</span><span class="p">,</span><span class="n">kubernetes.default</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">kubernetes</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">kubernetes</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kubernetes</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">kubernetes.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h2 id="the-service-account-key-pair">The Service Account Key Pair</h2>
<hr />
<p>The Kubernetes Controller Manager leverages a key pair to generate and sign service account tokens as describe in the managing service accounts documentation.</p>

<p>Generate the service-account certificate and private key:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

</span><span class="n">cat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">service</span><span class="o">-</span><span class="n">account</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"CN"</span><span class="o">:</span><span class="w"> </span><span class="s2">"service-accounts"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"algo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"size"</span><span class="o">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"names"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"C"</span><span class="o">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"L"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"O"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"OU"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kubernetes The Hard Way"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ST"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oregon"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">EOF</span><span class="w">

</span><span class="n">cfssl</span><span class="w"> </span><span class="n">gencert</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">=</span><span class="n">ca.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">ca</span><span class="o">-</span><span class="n">config.json</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="o">-</span><span class="n">profile</span><span class="o">=</span><span class="n">kubernetes</span><span class="w"> </span><span class="err">\</span><span class="w">
  </span><span class="n">service</span><span class="o">-</span><span class="n">account</span><span class="o">-</span><span class="n">csr.json</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cfssljson</span><span class="w"> </span><span class="o">-</span><span class="n">bare</span><span class="w"> </span><span class="n">service</span><span class="o">-</span><span class="n">account</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Results:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">service</span><span class="o">-</span><span class="n">account</span><span class="o">-</span><span class="n">key.pem</span><span class="w">
</span><span class="n">service</span><span class="o">-</span><span class="n">account.pem</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<h3 id="distribute-the-client-and-server-certificates">Distribute the Client and Server Certificates</h3>
<hr />
<p>Copy the appropriate certificates and private keys to each worker instance:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="w"> </span><span class="n">worker</span><span class="m">-2</span><span class="p">;</span><span class="w"> </span><span class="n">do</span><span class="w">
  </span><span class="n">lxc</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">ca.pem</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="n">.pem</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="w">
</span><span class="n">done</span><span class="w">
</span></code></pre></div></div>
<p>Copy the appropriate certificates and private keys to each controller instance:</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">controller</span><span class="m">-0</span><span class="w"> </span><span class="n">controller</span><span class="m">-1</span><span class="w"> </span><span class="n">controller</span><span class="m">-2</span><span class="p">;</span><span class="w"> </span><span class="n">do</span><span class="w">
  </span><span class="n">lxc</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">ca.pem</span><span class="w"> </span><span class="n">ca</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="n">kubernetes</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="n">kubernetes.pem</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="n">service</span><span class="o">-</span><span class="n">account</span><span class="o">-</span><span class="n">key.pem</span><span class="w"> </span><span class="n">service</span><span class="o">-</span><span class="n">account.pem</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">instance</span><span class="p">}</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="w">
</span><span class="n">done</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>Vervication:</p>
  <div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lxc</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">controller</span><span class="m">-0</span><span class="w"> </span><span class="n">ls</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w"> </span><span class="n">ls</span><span class="w"> 
</span></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p>The kube-proxy, kube-controller-manager, kube-scheduler, and kubelet client certificates will be used to generate client authentication configuration files in the next lab.</p>
</blockquote>

<p>Lanjutnye: <a href="https://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Generating-Kubernetes-Configuration-Files-for-Authentication-Part3/">Generating Kubernetes Configuration Files for Authentication - Part 3</a></p>

<h2 id="gaskunnnn">Gaskunnnn</h2>

<p><strong>Referensi</strong></p>
<ul>
  <li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/1.12.0">https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/1.12.0</a></li>
  <li><a href="https://www.youtube.com/watch?v=2bVK-e-GuYI&amp;t=560s">Kubernetes The Hard Way Just me and Opensource</a></li>
</ul>

<h1 id="happy--enjoy-ngoprek-">Happy,  Enjoy Ngoprek ~</h1>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#jekyll" class="page__taxonomy-item" rel="tag">Jekyll</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#update" class="page__taxonomy-item" rel="tag">update</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#cloud" class="page__taxonomy-item" rel="tag">cloud</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#container" class="page__taxonomy-item" rel="tag">container</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#kubernetes" class="page__taxonomy-item" rel="tag">kubernetes</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#ngoprek" class="page__taxonomy-item" rel="tag">ngoprek</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#server" class="page__taxonomy-item" rel="tag">server</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-13T00:00:00+07:00">April 13, 2020</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=%5BKubernetes+The+Hard+Way%5D+Provisioning+a+CA+and+Generating+TLS+Certificates+-+Part+2%20http%3A%2F%2Flocalhost%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-part2%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-part2%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-part2%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part1/" class="pagination--pager" title="[Kubernetes The Hard Way] Installing Client Tools - Part 1
">Previous</a>
    
    
      <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part3/" class="pagination--pager" title="[Kubernetes The Hard Way] Generating Kubernetes Configuration Files for Authentication - Part 3
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/security/Integrate-CEPH-in-Kolla-OPENSTACK/" rel="permalink">[Openstack] Integrate CEPH in Kolla OPENSTACK
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ
Integrate CEPH in Kolla OPENSTACK

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/security/Honeypot-kippo/" rel="permalink">[Security] Deployment Kippo Honeypot On Linux Ubuntu
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ
Deployment Kippo Honeypot On Linux Ubuntu

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part9/" rel="permalink">[Kubernetes The Hard Way] Deploying the DNS Cluster Add-on - FinalPart 9
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ
Deploying the DNS Cluster Add-on (Kubernetes The Hardway)

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part8/" rel="permalink">[Kubernetes The Hard Way] POD Network Routes - Part 8
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ
POD Network Routes (Kubernetes The Hardway)

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/ammarun11" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://instagram.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 My Personal Ngoprek Problems >_. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-part2/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/ngoprek/server/cloud/kubernetes/container/kubernetes-part2"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://masalahngoprek.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  




<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true
     },
     "HTML-CSS": { availableFonts: ["TeX"] }
   });
</script>


  </body>
</html>
