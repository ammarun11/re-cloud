<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[Kubernetes The Hard Way] Setup Lab Kubernetes Jalan Ninjaku - My Personal Ngoprek Problems &gt;_</title>
<meta name="description" content="Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ… Kubernetes Jalan Ninjaku (Kubernetes The Hardway)">


  <meta name="author" content=">_">
  
  <meta property="article:author" content=">_">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="My Personal Ngoprek Problems >_">
<meta property="og:title" content="[Kubernetes The Hard Way] Setup Lab Kubernetes Jalan Ninjaku">
<meta property="og:url" content="http://0.0.0.0:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-setup-lab-kubernetes-jalan-ninjaku/">


  <meta property="og:description" content="Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ… Kubernetes Jalan Ninjaku (Kubernetes The Hardway)">







  <meta property="article:published_time" content="2020-04-12T00:00:00+07:00">






<link rel="canonical" href="http://0.0.0.0:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-setup-lab-kubernetes-jalan-ninjaku/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://0.0.0.0:4000/"
    
  }
</script>


  <meta name="google-site-verification" content="zKB-7_EmphHj7Wpc-lRmu7BjIVPWRvMJkoqWQQBSjEI" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="My Personal Ngoprek Problems >_ Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          My Personal Ngoprek Problems >_
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">ğŸ¯ Home</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/">ğŸ“ Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/404.html">ğŸ† Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">ğŸ“š Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">ğŸ‘¨ About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt=">_" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">>_</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>â€œMy name is Ammar and this is my personal blog, documenting my journey on the quest to become the best person I can be.â€<br /></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://www.ammarun.my.id" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/ammarun11" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://instagram.com/nopallll" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[Kubernetes The Hard Way] Setup Lab Kubernetes Jalan Ninjaku">
    <meta itemprop="description" content="Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Kubernetes Jalan Ninjaku (Kubernetes The Hardway)">
    <meta itemprop="datePublished" content="2020-04-12T00:00:00+07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[Kubernetes The Hard Way] Setup Lab Kubernetes Jalan Ninjaku
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="Ø¨ÙØ³Ù’Ù…Ù-Ø§Ù„Ù„ÙÙ‘Ù‡Ù-Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù-Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…</h1>
<h2 id="kubernetes-jalan-ninjaku-kubernetes-the-hardway">Kubernetes Jalan Ninjaku (Kubernetes The Hardway)</h2>

<p>Okrayy pada tutorial kali ini kita akan mengkonfigurasi atau menjalankan kubernetes namun dengan cara the hardway, jadi kita membangun sebuah sistem kubernetes tanpa bantuan automasisasi atau library yang bisa langsung tuiing jdii tuh kebernetes cluster nya semisal minikube dan kubeadm (ya walaupun ini perlu di konfigurasi lgi sih hehehee)..</p>

<p>Tujuan Kubernetes The Hard Way ini untuk membantu kita untuk memahami bagaimana services, ecosystem dan cara kerja kubernetes secara menyeluruh jadi mantul buat yang merasa kubernetes ini adalah jalan ninjaku :D.</p>

<blockquote>
  <p>The results of this tutorial should not be viewed as production ready, and may receive limited support from the community, but donâ€™t let that stop you from learning! -Kelsey Higtower-</p>
</blockquote>

<ul>
  <li>Sumber utama : <a href="https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/1.12.0">kubernetes-the-hard-way</a></li>
</ul>

<p>alat dan bahan ambyarr:</p>

<ul>
  <li><a href="https://github.com/kubernetes/kubernetes">Kubernetes v1.12.0</a></li>
  <li><a href="https://github.com/containerd/containerd">Containerd Container Runtime v1.2.0-rc.0</a></li>
  <li><a href="https://github.com/google/gvisor">gVisor sandbox runtime </a></li>
  <li><a href="https://github.com/containernetworking/cni">CNI Container Networking v0.6.0</a></li>
  <li><a href="https://github.com/etcd-io/etcd">etcd v3.3.9</a></li>
  <li><a href="https://github.com/coredns/coredns">CoreDNS v1.2.2</a></li>
  <li>
    <p><a href="https://linuxcontainers.org">LXC Container v3.0.3</a></p>
  </li>
  <li>Dan untuk membangun tiap node nya saya menggunakan <a href="https://ammarun.my.id/ngoprek/server/cloud/lxc/container/lxd-containers-hypervisor/">LXC Container</a> yang sebelumnya sudah pernah saya tulis.</li>
</ul>

<h3 id="membuat-tiap-node-k8s">Membuat tiap node k8s</h3>
<p>Pertama kita membuat profile lxc untuk tiap node container k8s,</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lxc</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">edit</span><span class="w"> </span><span class="n">k8s</span><span class="w">

</span><span class="c1">###</span><span class="w">
</span><span class="n">config</span><span class="o">:</span><span class="w">
  </span><span class="n">limits.cpu</span><span class="o">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
  </span><span class="n">limits.memory</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="n">GB</span><span class="w">
  </span><span class="n">limits.memory.swap</span><span class="o">:</span><span class="w"> </span><span class="s2">"false"</span><span class="w">
  </span><span class="n">linux.kernel_modules</span><span class="o">:</span><span class="w"> </span><span class="n">ip_tables</span><span class="p">,</span><span class="n">ip6_tables</span><span class="p">,</span><span class="n">netlink_diag</span><span class="p">,</span><span class="n">nf_nat</span><span class="p">,</span><span class="n">overlay</span><span class="w">
  </span><span class="n">raw.lxc</span><span class="o">:</span><span class="w"> </span><span class="s2">"lxc.apparmor.profile=unconfined\nlxc.cap.drop= \nlxc.cgroup.devices.allow=a\nlxc.mount.auto=proc:rw
    sys:rw"</span><span class="w">
  </span><span class="n">security.nesting</span><span class="o">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="n">security.privileged</span><span class="o">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
</span><span class="n">description</span><span class="o">:</span><span class="w"> </span><span class="n">LXD</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Kubernetes</span><span class="w">
</span><span class="n">devices</span><span class="o">:</span><span class="w">
  </span><span class="n">eth0</span><span class="o">:</span><span class="w">
    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">eth0</span><span class="w">
    </span><span class="n">nictype</span><span class="o">:</span><span class="w"> </span><span class="n">bridged</span><span class="w">
    </span><span class="n">parent</span><span class="o">:</span><span class="w"> </span><span class="n">lxdbr0</span><span class="w">
    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">nic</span><span class="w">
  </span><span class="n">root</span><span class="o">:</span><span class="w">
    </span><span class="n">path</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="w">
    </span><span class="n">pool</span><span class="o">:</span><span class="w"> </span><span class="n">default</span><span class="w">
    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">disk</span><span class="w">
</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">used_by</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="c1">###</span><span class="w">
</span></code></pre></div></div>

<p>Kedua kita membuat tiap node container k8s,</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">images</span><span class="o">:</span><span class="n">centos</span><span class="o">/</span><span class="m">7</span><span class="w"> </span><span class="n">haproxy</span><span class="w"> 
</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">controller</span><span class="m">-0</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">controller</span><span class="m">-1</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">controller</span><span class="m">-2</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">

</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span><span class="n">lxc</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">:</span><span class="m">18.04</span><span class="w"> </span><span class="n">worker</span><span class="m">-2</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="n">k8s</span><span class="w">
</span></code></pre></div></div>

<p>cek node dengan <code class="language-plaintext highlighter-rouge">lxc list</code>,</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lxc</span><span class="w"> </span><span class="n">list</span><span class="w">

</span><span class="c1">###</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w">     </span><span class="n">NAME</span><span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="n">STATE</span><span class="w">  </span><span class="o">|</span><span class="w">        </span><span class="n">IPV4</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">IPV6</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="n">TYPE</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">SNAPSHOTS</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">controller</span><span class="m">-0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.88</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">controller</span><span class="m">-1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.161</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">controller</span><span class="m">-2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.39</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">haproxy</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.62</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">worker</span><span class="m">-0</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.79</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">worker</span><span class="m">-1</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.245</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">worker</span><span class="m">-2</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">RUNNING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">10.240.0.175</span><span class="w"> </span><span class="p">(</span><span class="n">eth0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">PERSISTENT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0</span><span class="w">         </span><span class="o">|</span><span class="w">
</span><span class="o">+--------------+---------+---------------------+------+------------+-----------+</span><span class="w">
</span><span class="c1">###</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Disini saya membuat sebanyak 7 node Container haproxy(Centos7) akan berperan sebagai loadbalancer ke setiap node controller(Ubuntu:18.04) dan worker(Ubuntu:18.04).</p>
</blockquote>

<p>Pertama kita setup Loadbalancer HAproxy nya duls :</p>

<p>Masuk ke container haproxy dan install paket haproxy</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">palo</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">ngoprek</span><span class="c1"># lxc exec haproxy bash </span><span class="w">
</span><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">haproxy</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="c1"># yum install -y haproxy net-tools nano</span><span class="w">
</span></code></pre></div></div>

<p>Edit file konfigurasi haproxy, dan hapus bagian frontend sampai bawah lalu tambahkan,</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nano</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">haproxy</span><span class="o">/</span><span class="n">haproxy.cfg</span><span class="w"> 

</span><span class="c1">###</span><span class="w">
</span><span class="n">frontend</span><span class="w"> </span><span class="n">k8s</span><span class="w">
  </span><span class="n">bind</span><span class="w"> </span><span class="m">10.240.0.62</span><span class="o">:</span><span class="m">6443</span><span class="w">
  </span><span class="n">mode</span><span class="w"> </span><span class="n">tcp</span><span class="w">
  </span><span class="n">default_backend</span><span class="w"> </span><span class="n">k8s</span><span class="w">

</span><span class="n">backend</span><span class="w"> </span><span class="n">k8s</span><span class="w">
  </span><span class="n">balance</span><span class="w"> </span><span class="n">roundrobin</span><span class="w">
  </span><span class="n">mode</span><span class="w"> </span><span class="n">tcp</span><span class="w">
  </span><span class="n">option</span><span class="w"> </span><span class="n">tcplog</span><span class="w">
  </span><span class="n">option</span><span class="w"> </span><span class="n">tcp</span><span class="o">-</span><span class="n">check</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="n">controller</span><span class="m">-0</span><span class="w"> </span><span class="m">10.240.0.88</span><span class="o">:</span><span class="m">6443</span><span class="w"> </span><span class="n">check</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="n">controller</span><span class="m">-1</span><span class="w"> </span><span class="m">10.240.0.161</span><span class="o">:</span><span class="m">6443</span><span class="w"> </span><span class="n">check</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="n">controller</span><span class="m">-2</span><span class="w"> </span><span class="m">10.240.0.39</span><span class="o">:</span><span class="m">6443</span><span class="w"> </span><span class="n">check</span><span class="w">
</span><span class="c1">###</span><span class="w">
</span></code></pre></div></div>

<p>Up service haproxy dan check,</p>
<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">systemctl</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">haproxy</span><span class="w">
</span><span class="n">systemctl</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">haproxy</span><span class="w">
</span><span class="n">systemctl</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="n">haproxy</span><span class="w">
</span><span class="n">netstat</span><span class="w"> </span><span class="o">-</span><span class="n">nltp</span><span class="w">

</span><span class="n">Active</span><span class="w"> </span><span class="n">Internet</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="p">(</span><span class="n">only</span><span class="w"> </span><span class="n">servers</span><span class="p">)</span><span class="w">
</span><span class="n">Proto</span><span class="w"> </span><span class="n">Recv</span><span class="o">-</span><span class="n">Q</span><span class="w"> </span><span class="n">Send</span><span class="o">-</span><span class="n">Q</span><span class="w"> </span><span class="n">Local</span><span class="w"> </span><span class="n">Address</span><span class="w">           </span><span class="n">Foreign</span><span class="w"> </span><span class="n">Address</span><span class="w">         </span><span class="n">State</span><span class="w">       </span><span class="n">PID</span><span class="o">/</span><span class="n">Program</span><span class="w"> </span><span class="n">name</span><span class="w">    
</span><span class="n">tcp</span><span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">10.240.0.62</span><span class="o">:</span><span class="m">6443</span><span class="w">       </span><span class="m">0.0.0.0</span><span class="o">:*</span><span class="w">               </span><span class="n">LISTEN</span><span class="w">      </span><span class="m">586</span><span class="o">/</span><span class="n">haproxy</span><span class="w">         
</span></code></pre></div></div>
<p>oke sudah selesai di setup haproxy nya lanjut ke node controller dan node worker ya lainnya,</p>

<p>Lab ini akan saya bagi beberapa part supaya tidak numpuk karena banyak service2 yang dibutuhkan uhuy :</p>

<ul>
  <li><a href="#">Setup Lab Kubernetes Jalan Ninjaku</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Installing-the-client-Tools-part1/">Installing the Client Tools - Part 1</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Provisioning-a-CA-and-Generating-TLS-Certificates-part2/">Provisioning the CA and Generating TLS Certificates - Part 2</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Generating-Kubernetes-Configuration-Files-for-Authentication-Part3/">Generating Kubernetes Configuration Files for Authentication - Part 3</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Generating-the-Data-Encryption-Config-and-Key-Part4/">Generating the Data Encryption Config and Key - Part 4</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Bootstrapping-the-etcd-Cluster-Part5/">Bootstrapping the etcd Cluster - Part 5</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Bootstrapping-the-Kubernetes-Control-Plane-Part6/">Bootstrapping the Kubernetes Control Plane - Part 6</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-Bootstrapping-the-Kubernetes-Worker-Nodes-Part7/">Bootstrapping the Kubernetes Worker Nodes - Part 7</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-part8/">Provisioning Pod Network Routes - Part 8</a></li>
  <li><a href="http://ammarun.my.id/ngoprek/server/cloud/kubernetes/container/kubernetes-part9/">Deploying the DNS Cluster Add-on - Part 9</a></li>
  <li><a href="docs/13-smoke-test.md">Smoke Test</a></li>
  <li><a href="docs/14-cleanup.md">Cleaning Up</a></li>
</ul>

<h2 id="gaskunnnn">Gaskunnnn</h2>

<p><strong>Referensi</strong></p>
<ul>
  <li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/1.12.0">https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/1.12.0</a></li>
  <li><a href="https://www.youtube.com/watch?v=2bVK-e-GuYI&amp;t=560s">Kubernetes The Hard Way Just me and Opensource</a></li>
</ul>

<h1 id="happy--enjoy-ngoprek-">Happy,  Enjoy Ngoprek ~</h1>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#jekyll" class="page__taxonomy-item" rel="tag">Jekyll</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#update" class="page__taxonomy-item" rel="tag">update</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#cloud" class="page__taxonomy-item" rel="tag">cloud</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#container" class="page__taxonomy-item" rel="tag">container</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#kubernetes" class="page__taxonomy-item" rel="tag">kubernetes</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#ngoprek" class="page__taxonomy-item" rel="tag">ngoprek</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#server" class="page__taxonomy-item" rel="tag">server</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-12T00:00:00+07:00">April 12, 2020</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=%5BKubernetes+The+Hard+Way%5D+Setup+Lab+Kubernetes+Jalan+Ninjaku%20http%3A%2F%2F0.0.0.0%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-setup-lab-kubernetes-jalan-ninjaku%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F0.0.0.0%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-setup-lab-kubernetes-jalan-ninjaku%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2F0.0.0.0%3A4000%2Fngoprek%2Fserver%2Fcloud%2Fkubernetes%2Fcontainer%2Fkubernetes-setup-lab-kubernetes-jalan-ninjaku%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ngoprek/server/cloud/lxc/container/lxd-containers-hypervisor/" class="pagination--pager" title="[LXC Containers] Play with LXD Container Hypervisor
">Previous</a>
    
    
      <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part1/" class="pagination--pager" title="[Kubernetes The Hard Way] Installing Client Tools - Part 1
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/security/Integrate-CEPH-in-Kolla-OPENSTACK/" rel="permalink">[Openstack] Integrate CEPH in Kolla OPENSTACK
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…
Integrate CEPH in Kolla OPENSTACK

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/security/Honeypot-kippo/" rel="permalink">[Security] Deployment Kippo Honeypot On Linux Ubuntu
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…
Deployment Kippo Honeypot On Linux Ubuntu

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part9/" rel="permalink">[Kubernetes The Hard Way] Deploying the DNS Cluster Add-on - FinalPart 9
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…
Deploying the DNS Cluster Add-on (Kubernetes The Hardway)

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/500x300.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ngoprek/server/cloud/kubernetes/container/kubernetes-part8/" rel="permalink">[Kubernetes The Hard Way] POD Network Routes - Part 8
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…
POD Network Routes (Kubernetes The Hardway)

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/ammarun11" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://instagram.com/ammarun" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 My Personal Ngoprek Problems >_. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "http://0.0.0.0:4000/ngoprek/server/cloud/kubernetes/container/kubernetes-setup-lab-kubernetes-jalan-ninjaku/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/ngoprek/server/cloud/kubernetes/container/kubernetes-setup-lab-kubernetes-jalan-ninjaku"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://masalahngoprek.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  




<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true
     },
     "HTML-CSS": { availableFonts: ["TeX"] }
   });
</script>


  </body>
</html>
